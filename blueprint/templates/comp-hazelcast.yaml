{{ $name := .Release.Name }}
{{- $gracefullyPaused := default false (and .Values.global .Values.global.gracefullyPaused) }}
{{- with .Values.backend }}
{{- with .deployments }}
{{- range $j, $d := . }}
{{- with $d.hazelcast }}
{{ $repository := .repository }}
{{ $version := .version }}
{{ $licenseKey := .licenseKey }}
{{- with .clusters }}
{{- range $i, $v := . }}
apiVersion: composition.krateo.io/v0-1-0
kind: Hazelcast
metadata:
  name: {{ $name }}-{{ $v.name }}-hzcomp
  annotations:
    krateo.io/paused: "{{ $gracefullyPaused }}"
spec:
  licenseKey: {{ $licenseKey }}
  repository: {{ $repository }}
  version: {{ $version }}
  cluster:
    name: {{ $v.name }}
    size: {{ $v.size }}
---
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}